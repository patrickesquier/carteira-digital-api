# ğŸ’° Carteira Digital Simplificada API

API RESTful para uma Carteira Digital com foco em cadastro, autenticaÃ§Ã£o segura (JWT), gerenciamento de contas e transferÃªncias financeiras entre usuÃ¡rios.

## ğŸ¯ Requisitos do Projeto

Este projeto implementa as seguintes funcionalidades principais:

| Funcionalidade | DescriÃ§Ã£o |
| :--- | :--- |
| **Cadastro** | Permite o registro com nome, email e senha. |
| **Saldo Inicial** | Toda nova conta recebe um saldo inicial de **R$ 100,00**. |
| **Login Seguro** | AutenticaÃ§Ã£o via email/senha que retorna um token **JWT**. |
| **TransferÃªncia** | Permite transferir valores entre contas, com verificaÃ§Ã£o de saldo e atomicidade garantida por **TransaÃ§Ãµes de Banco de Dados**. |
| **HistÃ³rico** | VisualizaÃ§Ã£o completa de transaÃ§Ãµes enviadas e recebidas. |
| **Conta** | VisualizaÃ§Ã£o dos seus dados junto com o valor que vocÃª ainda possui em conta. |

---

## ğŸ› ï¸ ConfiguraÃ§Ã£o e InstalaÃ§Ã£o

O projeto utiliza **Docker** para gerenciar o ambiente de desenvolvimento e o banco de dados **PostgreSQL**.

### 1. PrÃ©-requisitos

* Node.js (v18+)
* Docker e Docker Compose

### 2. VariÃ¡veis de Ambiente (`.env`)

Crie um arquivo `.env` na raiz do projeto com as seguintes variÃ¡veis.

```env
# VariÃ¡vel CrÃ­tica de SeguranÃ§a

JWT_SECRET="sua_chave_secreta_super_longa_e_aleatoria"

# ConfiguraÃ§Ãµes do Banco de Dados (PostgreSQL via Docker)
DB_HOST=db
DB_USER=root
DB_PASSWORD=senhadificil123
DB_DATABASE=minha_carteira

DB_DATABASE_TEST=minha_carteira_teste

POSTGRES_USER=root
POSTGRES_PASSWORD=senhadificil123
POSTGRES_DB=minha_carteira

SALTROEUNDS=10

```

### 3. ExecuÃ§Ã£o

Use o Docker Compose para subir a aplicaÃ§Ã£o e o banco de dados.

```
# 1. ConstrÃ³i a imagem e sobe os contÃªineres em segundo plano
docker-compose up --build -d

# 2. Executa as Migrations do banco de dados (Cria as tabelas)
docker-compose run --rm api npm run migrate:latest

# O servidor da API estarÃ¡ disponÃ­vel em: http://localhost:3000
```

## ğŸ—ï¸ Estrutura da AplicaÃ§Ã£o

A arquitetura do projeto segue o padrÃ£o de Camadas Separadas para garantir alta testabilidade e manutenÃ§Ã£o:

| DiretÃ³rio | Camada | Responsabilidade | Tecnologias Chave
| :--- | :--- | :--- | :--- |
| `src/api/routes` | Roteamento | Define os endpoints e aponta para o Controller correto. | Fastify, JWT Hooks, ValidaÃ§Ã£o Zod |
| `src/api/controllers` | Controle | Intermedeia a requisiÃ§Ã£o/resposta (HTTP) e chama o Service. | Fastify (``req``, ``reply``) |
| `src/api/services` | NegÃ³cio | ContÃ©m a lÃ³gica central da aplicaÃ§Ã£o (Regras de Saldo, TransaÃ§Ãµes atÃ´micas, etc.).	| Knex TransaÃ§Ãµes |
| `src/database` | Dados | ConfiguraÃ§Ã£o do Knex e todas as migrations de esquema. | Knex |
| `src/types` | Tipagem | DeclaraÃ§Ãµes de tipagem customizadas (Ex: Tipagem do payload JWT em ``fastify.d.ts``).	| TypeScript |

## ğŸ”‘ Endpoints Principais

| MÃ©todo | Caminho | ProteÃ§Ã£o | Controller | FunÃ§Ã£o | DescriÃ§Ã£o
| :--- | :--- | :--- | :--- | :--- | :--- |
| POST | ``/register`` | PÃºblica | ``UsersController`` | register | Cria novo usuÃ¡rio e conta (com saldo inicial). |
| POST | ``/login`` | PÃºblica | ``UsersController`` | login | Autentica o usuÃ¡rio e retorna o JWT. |
| POST | ``/logout`` | PÃºblica | ``UsersController`` | logout | Apagar o tocken dos cookies. |
| GET | ``/account`` | JWT | ``AccountController`` | getAccount | Retorna os dados do usuÃ¡rio logado. |
| POST | ``/transfers`` | JWT | ``TransfersController`` | createTransfers | Executa uma transferÃªncia de conta para conta. |
| GET | ``/history`` | JWT | ``HistoryController`` | getTransfersHistory | Retorna o histÃ³rico de transaÃ§Ãµes (enviadas e recebidas). |

## ğŸ§ª Estrutura de Teste Manual

VocÃª pode testar o fluxo completo com as seguintes etapas:

---

### **1ï¸âƒ£ Criar dois usuÃ¡rios**

```bash
POST /register
{
  "name": "UsuÃ¡rio 1",
  "email": "usuario1@email.com",
  "password_hash": "12345"
}
```

```bash
POST /register
{
  "name": "UsuÃ¡rio 2",
  "email": "usuario2@email.com",
  "password_hash": "12345"
}
```

### **2ï¸âƒ£ Fazer login em um dos usuÃ¡rios**

```bash
POST /login
{
  "email": "usuario1@email.com",
  "password_hash": "12345"
}
```

### **3ï¸âƒ£ Consultar saldo**

```bash
GET /account
```

### **4ï¸âƒ£ Criar uma transferÃªncia**

```bash
POST /transfers
{
  "receiver_email": "usuario2@email.com",
  "amount": 10,
  "description": "Primeiro envio"
}
```

### **5ï¸âƒ£ Ver histÃ³rico de transaÃ§Ãµes**

```bash
GET /history
```

### **6ï¸âƒ£ Fazer logout**


```bash
POST /logout
```

---

## ğŸ§± Tecnologias Utilizadas

- **Node.js** â€” ambiente de execuÃ§Ã£o  
- **Fastify** â€” framework web leve e rÃ¡pido  
- **TypeScript** â€” tipagem estÃ¡tica e seguranÃ§a de cÃ³digo  
- **Knex.js** â€” query builder para PostgreSQL  
- **JWT** â€” autenticaÃ§Ã£o segura  
- **Docker** â€” ambiente isolado e padronizado  
- **Zod** â€” validaÃ§Ã£o de dados  

---

## ğŸ§© Melhorias Futuras

- [ ] Endpoint para **depÃ³sitos e saques**
- [ ] Implementar **limite diÃ¡rio de transferÃªncias**
- [ ] Adicionar **Swagger** para documentaÃ§Ã£o interativa da API

--- 

## ğŸ§‘â€ğŸ’» Autor

**Patrick Esquier Silvy**  
ğŸ’¼ Desenvolvedor 
ğŸ“§ [patricksilvy.contato@gmail.com](mailto:patricksilvy.contato@gmail.com)
