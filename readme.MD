# üí∞ Carteira Digital Simplificada API

API RESTful para uma Carteira Digital com foco em cadastro, autentica√ß√£o segura (JWT), gerenciamento de contas e transfer√™ncias financeiras entre usu√°rios.

## üéØ Requisitos do Projeto

Este projeto implementa as seguintes funcionalidades principais:

| Funcionalidade | Descri√ß√£o |
| :--- | :--- |
| **Cadastro** | Permite o registro com nome, email e senha. |
| **Saldo Inicial** | Toda nova conta recebe um saldo inicial de **R$ 100,00**. |
| **Login Seguro** | Autentica√ß√£o via email/senha que retorna um token **JWT**. |
| **Transfer√™ncia** | Permite transferir valores entre contas, com verifica√ß√£o de saldo e atomicidade garantida por **Transa√ß√µes de Banco de Dados**. |
| **Hist√≥rico** | Visualiza√ß√£o completa de transa√ß√µes enviadas e recebidas. |
| **Conta** | Visualiza√ß√£o dos seus dados junto com o valor que voc√™ ainda possui em conta. |

---

## üõ†Ô∏è Configura√ß√£o e Instala√ß√£o

O projeto utiliza **Docker** para gerenciar o ambiente de desenvolvimento e o banco de dados **PostgreSQL**.

### 1. Pr√©-requisitos

* Node.js (v18+)
* Docker e Docker Compose

### 2. Vari√°veis de Ambiente (`.env`)

Crie um arquivo `.env` na raiz do projeto com as seguintes vari√°veis.

```env
# Vari√°vel Cr√≠tica de Seguran√ßa

JWT_SECRET="sua_chave_secreta_super_longa_e_aleatoria"

# Configura√ß√µes do Banco de Dados (PostgreSQL via Docker)
DB_HOST=db
DB_USER=root
DB_PASSWORD=senhadificil123
DB_DATABASE=minha_carteira

DB_DATABASE_TEST=minha_carteira_teste

POSTGRES_USER=root
POSTGRES_PASSWORD=senhadificil123
POSTGRES_DB=minha_carteira

```

### 3. Execu√ß√£o

Use o Docker Compose para subir a aplica√ß√£o e o banco de dados.

```
# 1. Constr√≥i a imagem e sobe os cont√™ineres em segundo plano
docker-compose up --build -d

# 2. Executa as Migrations do banco de dados (Cria as tabelas)
docker-compose run --rm api npm run migrate:latest

# O servidor da API estar√° dispon√≠vel em: http://localhost:3000
```

## üèóÔ∏è Estrutura da Aplica√ß√£o

A arquitetura do projeto segue o padr√£o de Camadas Separadas para garantir alta testabilidade e manuten√ß√£o:

| Diret√≥rio | Camada | Responsabilidade | Tecnologias Chave
| :--- | :--- | :--- | :--- |
| `src/api/routes` | Roteamento | Define os endpoints e aponta para o Controller correto. | Fastify, JWT Hooks, Valida√ß√£o Zod |
| `src/api/controllers` | Controle | Intermedeia a requisi√ß√£o/resposta (HTTP) e chama o Service. | Fastify (``req``, ``reply``) |
| `src/api/services` | Neg√≥cio | Cont√©m a l√≥gica central da aplica√ß√£o (Regras de Saldo, Transa√ß√µes at√¥micas, etc.).	| Knex Transa√ß√µes |
| `src/database` | Dados | Configura√ß√£o do Knex e todas as migrations de esquema. | Knex |
| `src/types` | Tipagem | Declara√ß√µes de tipagem customizadas (Ex: Tipagem do payload JWT em ``fastify.d.ts``).	| TypeScript |

## üîë Endpoints Principais

| M√©todo | Caminho | Prote√ß√£o | Controller | Fun√ß√£o | Descri√ß√£o
| :--- | :--- | :--- | :--- | :--- | :--- |
| POST | ``/users`` | P√∫blica | ``UsersController`` | register | Cria novo usu√°rio e conta (com saldo inicial). |
| POST | ``/login`` | P√∫blica | ``UsersController`` | login | Autentica o usu√°rio e retorna o JWT. |
| GET | ``/account`` | JWT | ``AccountController`` | getAccount | Retorna os dados do usu√°rio logado. |
| POST | ``/transactions`` | JWT | ``TransfersController`` | createTransfers | Executa uma transfer√™ncia de conta para conta. |
| GET | ``/history`` | JWT | ``HistoryController`` | getTransfersHistory | Retorna o hist√≥rico de transa√ß√µes (enviadas e recebidas). |